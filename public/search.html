<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lotivis@latest/dist/lotivis.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
  <title>FRCV - Search</title>
</head>
<body>

<div class="container">
  <div class="row">
    <div class="col-2">
      <a href="index.html">
        <button class="back-button">
          Back
        </button>
      </a>
    </div>
    <div class="col-8 text-center">
      <h1></h1>
    </div>
    <div class="col-12">
      <div class="card">
        <div class="card-body margin-top margin-bottom">
          <div class="row">
            <div class="col-12 text-center">
              <label for="search-input"></label>
              <input class="form-control form-control-sm"
                     type="text"
                     placeholder="Search Word"
                     id="search-input"
                     list="search-input-data"
                     onkeydown="search(this)">
              <datalist id="search-input-data"></datalist>
            </div>

            <div class="col-2 text-center">
              <label for="case-sensitivity-dropdown">Case Sens.</label>
              <select id="case-sensitivity-dropdown">
                <option id="case-sensitive" value="case-sensitive">Yes</option>
                <option id="case-insensitive" value="case-insensitive">No</option>
              </select>
            </div>
            <div class="col-3 text-center">
              <label for="from-dropdown">From</label>
              <select id="from-dropdown">
                <option id="from-1995" value="1995">1995</option>
              </select>
              <label for="to-dropdown">To</label>
              <select id="to-dropdown">
                <option id="to-1995" value="1995">1995</option>
              </select>
            </div>
            <div class="col-2">
              <form class="radio-group">
                <input id="relative-radio"
                       name="relative-absolute"
                       class="form-control form-control-sm"
                       type="radio"
                       checked>
                <label for="relative-radio">Rel.</label>
                <input id="absolute-radio"
                       name="relative-absolute"
                       class="form-control form-control-sm"
                       type="radio">
                <label for="absolute-radio">Abs.</label>
              </form>
            </div>
            <div class="col-2">
              <button class="back button-down">
                Innovation List
              </button>
            </div>
            <div class="col-3 text-center">
              <button class="back round-button">
                Search
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-6">
      <div id="time-chart-card">
      </div>
      <div id="plot-chart-card">
      </div>
    </div>
    <div class="col-6">
      <div id="map-chart-card">
      </div>
    </div>
    <div class="col-6">
      <div id="about-card">
      </div>
    </div>
    <div class="col-12 text-center">
      <div id="footer">Loading...</div>
    </div>
  </div><!-- row -->
</div><!-- container -->

<script src="https://cdn.jsdelivr.net/npm/d3@6.5.0/dist/d3.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@nidi/html2canvas@1.0.0-rc.13/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lotivis@1.0.33/dist/lotivis.js"></script>
<script src="js/frcv.js"></script>

<script>

  let timeChartCard = new lotivis.TimeChartCard('time-chart-card');
  let mapChartCard = new lotivis.MapChartCard('map-chart-card');
  mapChartCard.chart.excludedFeatureCodes = ['2A', '2B'];
  let plotChartCard = new lotivis.PlotChartCard('plot-chart-card');
  let aboutCard = new lotivis.PlotChartCard('about-card');
  let loadingView = document.getElementById('footer');

  let corpus = new frcv.Corpus('');

  d3.json('/assets/Departements.geojson')
    .then(function (geoJSON) {
      mapChartCard.chart.setGeoJSON(new lotivis.GeoJson(geoJSON));
    });

  d3.json('/corpus')
    .then(function (corpusJSON) {
      corpus = new frcv.Corpus(corpusJSON);
      loadingView.style.display = 'none';
    })
    .catch(function (error) {
      console.error(error);
    });

  function search(input) {
    if (!this.event || this.event.key !== 'Enter') return;
    let searchText = input.value;

    if (searchText === undefined) {
      return console.log('search text undefined');
    } else if (searchText.trim().length === 0) {
      return console.log('search text too short');
    }

    console.log('corpus', corpus);

    let datasets = corpus.search(searchText);
    let controller = new lotivis.FilterableDatasetController(datasets);
    console.log('datasets', datasets);

    timeChartCard.chart.setDatasetController(controller);
    timeChartCard.chart.update();
    mapChartCard.chart.setDatasetController(controller);
    plotChartCard.chart.setDatasetController(controller);

  }

</script>

</body>
</html>
